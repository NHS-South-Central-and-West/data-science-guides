---
title: "Exploratory Data Analysis in R"
author: "Paul Johnson"
date: today
---

Exploratory data analysis (EDA) is the first step in any advanced analytics work, and can even serve as as a piece of analysis itself.

## Setup

```{r}
#| label: setup

# import packages
suppressPackageStartupMessages({
  library(dplyr)
  library(ggplot2)
})

# set ggplot theme
theme_set(theme_minimal())

# import data
df <- readr::read_csv(here::here('data', 'heart_disease.csv'))

# convert discrete variables to factor type
df <- df |> 
  mutate(
    sex = as.factor(sex),
    fasting_bs = as.factor(fasting_bs),
    resting_ecg = as.factor(resting_ecg),
    angina = as.factor(angina),
    heart_disease = as.factor(heart_disease)
  )

```


## Data Exploration

The first step when doing EDA is to examine the data itself and get an idea of the structure of the dataset, the variable types, and the typical values of each variable. This gives a better understanding of exactly what data is being used and informs decisions both about the next steps in the exploratory process and any modelling choices.

```{r}
#| label: explore

# view first rows in the dataset
head(df)

# overview of the data
glimpse(df)

# unique values of the outcome variable
unique(df$heart_disease)

# unique values of a continuous explanatory variable
unique(df$cholesterol)

```

# Summary Statistics

```{r}
#| label: summary-stats

summary(df)

# heart disease
df |>
  count(heart_disease)

# resting ecg
df |>
  count(resting_ecg)

df |> 
  group_by(resting_ecg) |> 
  count(heart_disease) |> 
  mutate(freq = n/sum(n))

# angina
df |>
  count(angina)

# cholesterol
df |> 
  count(cholesterol)

```

# Data Visualisation

## Distributions

```{r}
#| label: distributions
#| message: false
#| warning: false

# age distribution
df |>
  ggplot(aes(age)) +
  geom_histogram(binwidth = 5)

# age distribution by heart disease
df |>
  ggplot(aes(age, fill = heart_disease)) +
  geom_histogram(binwidth = 5, position = "dodge")

# sex distribution by heart disease
df |>
  ggplot(aes(sex, fill = heart_disease)) +
  geom_bar(position = "dodge")

# resting ecg distribution by heart disease
df |>
  ggplot(aes(resting_ecg, fill = heart_disease)) +
  geom_bar(position = "dodge")

# max hr
df |>
  ggplot(aes(max_hr, fill = heart_disease)) +
  geom_histogram(position = "dodge")

df |>
  ggplot(aes(max_hr, fill = heart_disease)) +
  geom_histogram(position = "dodge")

# heart peak reading
df |>
  ggplot(aes(heart_peak_reading)) +
  geom_histogram()

df |>
  ggplot(aes(heart_peak_reading, fill = heart_disease)) +
  geom_histogram(position = "dodge")

# cholesterol  
df |>
  ggplot(aes(cholesterol)) +
  geom_histogram()

df |>
  ggplot(aes(cholesterol, fill = heart_disease)) +
  geom_histogram(position = "dodge")


# angina
df |>
  ggplot(aes(angina, fill = heart_disease)) +
  geom_bar(position = "dodge")

# fasting bs
df |>
  ggplot(aes(fasting_bs, fill = heart_disease)) +
  geom_bar(position = "dodge")

```

## Association (Relationship) Between Variables

### Box Plots

Box plots are an effective way to visualize the observed relationship between a continuous explanatory variable and a discrete outcome (whether binary, ordinal, or categorical). 

```{r}
#| label: boxplots
#| message: false
#| warning: false

# age and heart disease
df |>
  ggplot(aes(age, heart_disease, fill = heart_disease)) +
  geom_boxplot()

# max hr and heart disease
df |>
  ggplot(aes(max_hr, heart_disease, fill = heart_disease)) +
  geom_boxplot()



```

### Scatter Plots

Scatter plots are appropriate when seeking to visualize the association between two continuous variables, or a continuous variable and the continuous outcome.

```{r}
#| label: scatterplots
#| message: false
#| warning: false

# cholesterol
df |>
  ggplot(aes(cholesterol, max_hr, colour = heart_disease)) +
  geom_point(size=2)

# filtering out zero values

df |> 
  filter(cholesterol != 0) |> 
  ggplot(aes(cholesterol, max_hr, colour = heart_disease)) +
  geom_point(size=2)

```